!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t){},,,function(e,t,n){function o(e){return document.querySelector(e)}n(0);var i={init:function(){this.initPage(),this.loadImg(),this.userData(),this.music()},initPage:function(){var e=this,t=o(".show-mine"),n=o(".once-again"),i=o(".share-info"),s=o(".share-guide"),r=o(".music"),a=o(".not-share .font-welcome"),t=o(".show-mine");e.setPageSize();var c=new Swiper(".swiper-container",{speed:400,direction:"vertical",onSlideChangeStart:function(n){e.convertArray(document.querySelectorAll(".font-abc")).forEach(function(e){e.style.display="none"}),n.slides[n.activeIndex].querySelector(".font-abc")&&(n.slides[n.activeIndex].querySelector(".font-abc").style.display="block"),0==n.activeIndex&&(t.style.display="none"),0!=n.activeIndex&&(t.style.display="block"),4==n.activeIndex&&e.convertArray(o(".borrowlist-container").querySelectorAll(".font-abc")).forEach(function(e){e.style.display="block"}),4!=n.activeIndex&&e.convertArray(o(".borrowlist-container").querySelectorAll(".font-abc")).forEach(function(e){e.style.display="none"})}});t.addEventListener("touchstart",function(){window.location="./home.html"}),n.addEventListener("touchstart",function(){c.forEach(function(e){e.slideTo(0,1500,!1)}),a.style.display="block"}),i.addEventListener("touchstart",function(){s.style.display="block",r.style.display="none"}),s.addEventListener("touchstart",function(){s.style.display="none",r.style.display="block"}),console.log("初始化页面成功")},setPageSize:function(){var e=this,t=document.documentElement.clientWidth,n=document.documentElement.clientHeight,o=document.querySelectorAll(".swiper-content");e.convertArray(o).forEach(function(e){e.style.width="750px",e.style.height="1334px",e.style.position="absolute",e.style.top="50%",e.style.left="50%";var o=t/750,i=n/1334;e.style.transformOrigin="0 0",e.style.transform="scale("+o+","+i+")translate(-50%, -50%)"})},loadImg:function(){for(var e=this,t=["pg1_welcome.png","pg2_firsttime.png","pg3_firstbook.png","pg4_total.png","pg5_booklist_bottom.png","pg6_interest.png","pg7_lastbook.png","pg8_epilogue.png","pg9_final.png"],n=0,o=t.length,i=0;i<o;i++){var s=new Image;s.src="http://source.igdut.cn/1.4/"+t[i],s.onload=function(){n++,e.convertArray(document.querySelectorAll(".progress")).forEach(function(e){e.innerHTML=Math.floor(n/o*100)+"%"}),n==o&&(console.log("所有图片预加载成功"),e.showPage())},s.onerror=function(){console.log("图片并未成功加载"),e.sendMsg("E5","imgLoadErr"),e.showPage()}}},userData:function(){var e=this,t=window.location.search,n=o(".not-share"),i=o(".is-share");1==t.indexOf("share=")?e.getQueryString(function(t){n.style.display="none",e.fillShareData(t)}):(i.style.display="none",e.ajax("POST","cmd=getinfo","./interface.php",function(t){switch(t.code){case 0:e.showAlert("未能获取到信息，请返回重新登录。"),window.location="./index.html";break;case 1:console.log("获取信息成功"),e.fillRequestData(t.msg,function(t){setTimeout(function(){e.wechatAction(t)},1e3)});break;default:e.showAlert("出错啦~请稍后登录呗~"),e.sendMsg("E2","responseErr-211"+t.code+t.msg)}}))},fillShareData:function(e){this.convertArray(document.querySelectorAll(".is-share .data")).forEach(function(t,n){t.innerHTML=e[n]}),document.title="2017 | 馆藏记忆 一一 "+e[0]+"的图书馆时光"},fillRequestData:function(e,t){var n=this,i=[],s=function(e){var t=e.split("-");return"<span class='highlight'>"+t[0]+"</span>年<span class='highlight'>"+t[1]+"</span>月<span class='highlight'>"+t[2]+"</span>日"};i[0]=e.name,i[1]=s(e.entertime),i[2]=s(e.firstbooktime),i[3]=e.gap,i[4]="《"+e.firstbook+"》",i[5]=e.grade,i[6]=e.bookcount,i[7]=(100*+e.rankingrade).toFixed(1)+"%",i[8]=function(e){return e>=80?"“工大学霸”":e>=30?"“热情读者”":'"最具潜力读者"'}(e.bookcount),i[9]=e.favorite.split(",")[0],i[10]=e.bookcount,i[11]=e.favorite.split(",")[1],i[12]=function(e){var t=e.split("-");return"在<span class='highlight'>"+t[0]+"</span>年的<span class='highlight'>"+t[1]+"</span>月<span class='highlight'>"+t[2]+"</span>日"}(e.lastbooktime),i[13]="《"+e.lastbook+"》",n.convertArray(document.querySelectorAll(".not-share .data")).forEach(function(e,t){e.innerHTML=i[t]}),function(e,t){var n="",i=Math.ceil(e.length/10);1==i&&(o(".hand-tip").style.display="none");for(var s=1;s<=i;s++){var r=10*(s-1)+1;if(t[s-1]<80?n+="<div class='swiper-slide h-slide h-slide"+s+"'><ul class='font-abc font-borrowlist-books font-big'>":t[s-1]<120?n+="<div class='swiper-slide h-slide h-slide"+s+"'><ul class='font-abc font-borrowlist-books'>":t[s-1]<190?n+="<div class='swiper-slide h-slide h-slide"+s+"'><ul class='font-abc font-borrowlist-books font-small'>":n+="<div class='swiper-slide h-slide h-slide"+s+"'><ul class='font-abc font-borrowlist-books font-very-small'>",s!=i)for(var a=0;a<10;a++)n+="<li>"+(r+a)+".《"+e.shift()+"》</li>";if(s==i)for(var a=0;e.length>0;)n+="<li>"+(r+a)+".《"+e.shift()+"》</li>",a++;n+="</ul><div class='h-bottom-style'></div></div>"}o(".not-share .data10").innerHTML=n;new Swiper(".borrowlist-container",{direction:"horizontal",slidesPerView:"auto",centeredSlides:!0,spaceBetween:25})}(e.books,e.booknum),t&&t(i)},showPage:function(){var e=this,t=o(".music");setTimeout(function(){e.convertArray(document.querySelectorAll(".loading-content")).forEach(function(e){e.style.display="none"}),t.style.display="block",e.convertArray(document.querySelectorAll(".slide1")).forEach(function(e){e.setAttribute("class",e.getAttribute("class").replace(" swiper-no-swiping",""))})},1e3)},music:function(){var e=this,t=o(".music"),n=o(".audio"),i=!0;t.addEventListener("touchstart",function(){i?(t.setAttribute("class","music music-play"),n.play()):(t.setAttribute("class","music"),n.pause()),i=!i}),e.triggerEvent(t,"touchstart")},getQueryString:function(e){var t=this,n=[],o=window.location.href.split("?")[1].split("&")[0].split("=")[1];try{o=TK.de(o)}catch(e){t.showAlert("分享链接失效，请返回重新登录~"),t.sendMsg("S5","shareInfoErr-611"+e.message),window.location="./index.html"}n=o.split(";"),14==n.length?e&&e(n):(t.showAlert("分享链接失效，请返回重新登录~"),t.sendMsg("S5","shareInfoErr-612"),window.location="./index.html")},setQueryString:function(e){var t="";return e.forEach(function(e,n){t+=13!=n?e+";":e}),"?share="+TK.en(t)},wechatAction:function(e){var t=this;if(t.isWechat()){console.log("微信内,开始执行分享设置");var n=window.location.href.split("#")[0],o="cmd=wx&url="+TK.en(n);t.ajax("POST",o,"./interface.php",function(n){switch(n.code){case 1:t.setWechatConf(n.msg,e);break;default:t.showAlert("设置分享内容失败,请稍后再试~"),t.sendMsg("E2","responseErr-212"+n.code+n.msg)}})}},isWechat:function(){return!!(navigator.userAgent.indexOf("MicroMessenger")>=0&&window.wx)},setWechatConf:function(e,t){var n=this,i=window.location.href.split("?")[0]+n.setQueryString(t),s="2017 | 馆藏记忆 一一 "+o(".not-share .data1").innerHTML+"的图书馆时光",r="欢迎来到2017广东工业大学图书馆毕业纪念册",a="http://source.igdut.cn/1.4/login_logo.png";wx.config({debug:!1,appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:s,link:i,imgUrl:a,success:function(){n.sendMsg("S1","onMenuShareTimeline")},cancel:function(){}}),wx.onMenuShareAppMessage({title:s,desc:r,link:i,imgUrl:a,type:"",dataUrl:"",success:function(){n.sendMsg("S2","onMenuShareAppMessage")},cancel:function(){}}),wx.onMenuShareQQ({title:s,desc:r,link:i,imgUrl:a,success:function(){n.sendMsg("S3","onMenuShareQQ")},cancel:function(){}})}),wx.error(function(e){n.showAlert("设置分享内容失败,请稍后再试~"),n.sendMsg("S4","wxConfigErr"+e)})},triggerEvent:function(e,t){var n=document.createEvent("HTMLEvents");return n.eventName=t,n.initEvent(t,!0,!0),!e.dispatchEvent(n)},convertArray:function(e){return Array.prototype.slice.call(e,0)},showAlert:function(e){var t=document.createElement("IFRAME");t.style.display="none",t.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(t),window.frames[0].window.alert(e),t.parentNode.removeChild(t)},showConfirm:function(e){var t=document.createElement("IFRAME");t.style.display="none",t.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(t);var n=window.frames[0],o=n.window.confirm(e);return t.parentNode.removeChild(t),o},sendMsg:function(e,t){var n=this,o="cmd=log&info="+e+":"+t;setTimeout(function(){n.ajax("POST",o,"./interface.php",function(e){switch(e.code){case 1:console.log("发送信息成功");break;default:console.log("发送信息失败,遇到未知错误--"+e.code+e.msg)}})},1e3)},ajax:function(e,t,n,o){var i=this,e=e||"GET",t=t||null,n=n||"",s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==s.readyState)if(s.status>=200&&s.status<300||304==s.status){try{var e=JSON.parse(TK.de(s.responseText.slice(9)))}catch(e){return i.showAlert("系统出错,请联系管理员~"),i.sendMsg("E4","responseTextErr-"+e.message),!1}o&&o(e)}else i.showAlert("出错啦~请稍后登录呗~"),i.sendMsg("E1","requestErr-101"),location.reload()},s.onerror=function(e){i.showAlert("出错啦~请稍后登录呗~"),i.sendMsg("E1","requestErr-102"+e.message),location.reload()},s.open(e,n,!0),"POST"==e&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(t)}};document.addEventListener("DOMContentLoaded",function(e){i.init()})}]);