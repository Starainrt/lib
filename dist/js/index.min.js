!function(e){function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=4)}([,function(e,n){},function(e,n){},,function(e,n,t){function i(e){return document.querySelector(e)}t(2),t(1);var o={init:function(){this.initPage(),this.wechatAction()},initPage:function(){var e=this,n=i("#login-btn"),t=i("#sno"),o=i("#sname");n.addEventListener("touchstart",function(n){var i=t.value.trim(),s=o.value.trim();e.changeLoginBtn(),e.verify(i,s,function(n){e.ajax("POST",e.s(n,"login",s,"gdutlib"),"./api/interface.php",function(n){switch(n.code){case-3:e.showAlert("您已经超过登录帐号限制，请稍后再登录~ (如有误伤,请联系管理员hi@iGDUT.cn~)"),e.sendMsg("E311","beyondLogin");break;case-2:case-1:e.showAlert("您的输入有误，请检查后重新输入~");break;case 0:e.showAlert("您输入的姓名或学号有误，请重新输入~");break;case 1:window.location="./home.html";break;case 2:e.showAlert("很遗憾，您大学期间未借过书，无法进入『馆藏记忆』~");break;default:e.showAlert("出错啦~请联系管理员hi@iGDUT.cn~"),e.sendMsg("E211","responseErr--"+n.code+n.msg)}e.changeLoginBtn()})})}),console.log("初始化页面成功")},verify:function(e,n,t){var i=this;if(/^\d{10}$/.test(e)&&/^[\u4e00-\u9fa5·•﹒]+$/.test(n)){console.log("check ok");var o="uid="+e+"&name="+n+"&cmd=login";"3"==e[3]?t&&t(o):"6"==e[3]||"5"==e[3]||"4"==e[3]?i.showConfirm("本纪念册为毕业生而设计，您不是大四毕业生，确定要继续访问吗？")?t&&t(o):i.changeLoginBtn():(i.showAlert("抱歉，本纪念册仅向在读本科生开放。(如有错漏,请联系管理员hi@iGDUT.cn~)"),i.changeLoginBtn())}else i.showAlert("您输入的姓名或学号格式有误，请检查后重新输入~"),i.changeLoginBtn()},changeLoginBtn:function(){var e=i("#login-btn");"login-submit login-waiting"==e.className?(e.className="login-submit",e.setAttribute("value","登录")):(e.className="login-submit login-waiting",e.setAttribute("value","登录中..."))},wechatAction:function(){var e=this;if(e.isWechat()){var n=window.location.href.split("#")[0],t="cmd=wx&url="+TK.en(n);e.ajax("POST",t,"./api/interface.php",function(n){switch(n.code){case 1:e.setWechatConf(n.msg);break;default:console.log("设置分享内容失败,请稍后再试~"),e.sendMsg("E212","responseErr--"+n.code+n.msg)}})}},isWechat:function(){return!!(navigator.userAgent.indexOf("MicroMessenger")>=0&&window.wx)},setWechatConf:function(e){var n=this,t="https://www.igdut.cn/",i="2017 | 馆藏记忆",o="缤纷毕业季，青春不散场！欢迎来到图书馆2017届毕业纪念册“馆藏记忆”。",s="https://www.igdut.cn/img/2.0/login_logo.jpg";wx.config({debug:!1,appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:i,link:t,imgUrl:s,success:function(){n.sendMsg("S111","onMenuShareTimeline")},cancel:function(){}}),wx.onMenuShareAppMessage({title:i,desc:o,link:t,imgUrl:s,type:"",dataUrl:"",success:function(){n.sendMsg("S211","onMenuShareAppMessage")},cancel:function(){}}),wx.onMenuShareQQ({title:i,desc:o,link:t,imgUrl:s,success:function(){n.sendMsg("S311","onMenuShareQQ")},cancel:function(){}})}),wx.error(function(e){console.log("设置分享内容失败,请稍后再试~"),n.sendMsg("S411","wxConfigErr--"+e)})},triggerEvent:function(e,n){var t=document.createEvent("HTMLEvents");return t.eventName=n,t.initEvent(n,!0,!0),!e.dispatchEvent(t)},showAlert:function(e){var n=document.createElement("IFRAME");n.style.display="none",n.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(n),window.frames[0].window.alert(e),n.parentNode.removeChild(n)},showConfirm:function(e){var n=document.createElement("IFRAME");n.style.display="none",n.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(n);var t=window.frames[0],i=t.window.confirm(e);return n.parentNode.removeChild(n),i},s:function(e,n,t,i){return e+"&secu="+AK(n+t+i)},sendMsg:function(e,n){var t=this,i="cmd=log&info="+e+":"+n;t.ajax("POST",i,"./api/interface.php",function(e){switch(e.code){case 1:console.log("发送信息成功");break;default:console.log("发送信息失败,遇到未知错误--"+e.code+e.msg)}})},ajax:function(e,n,t,i){var o=this,e=e||"GET",n=n||null,t=t||"",s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==s.readyState)if(s.status>=200&&s.status<300||304==s.status){try{var e=JSON.parse(TK.de(s.responseText.slice(9)))}catch(e){return o.showAlert("系统出错,请联系管理员hi@iGDUT.cn~"),o.sendMsg("E411","responseTextErr--"+e.message),!1}i&&i(e)}else o.showAlert("出错啦~请联系管理员hi@iGDUT.cn~"),o.sendMsg("E111","requestErr"),location.reload()},s.onerror=function(e){o.showAlert("出错啦~请联系管理员hi@iGDUT.cn~"),o.sendMsg("E112","requestErr"+e.message),location.reload()},s.open(e,t,!0),"POST"==e&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(n)}};document.addEventListener("DOMContentLoaded",function(e){o.init()})}]);